{% extends 'base/site_base.html.twig' %}

{% block title %}Produits{% endblock %}

{% block body %}
    <h1>Liste des produits disponibles</h1>

    <table class="table table-bordered mt-4">
        <thead>
            <tr>
                <th>Image</th>
                <th>Nom</th>
                <th>Prix</th>
                <th>Stock</th>
                <th>Commande</th>
            </tr>
        </thead>
        <tbody>
            {% for produit in produits %}
                {% set id = produit.id %}
                {% set stock = produit.stock %}
                {% set deja_commande = panier[id]|default(0) %}
                {% set min = -deja_commande %}
                {% set max = stock %}
                {% if max == 0 and min == 0 %}
                    {% set max = 1 %}
                {% endif %}
                <tr>
                    <td>
                        <img src="{{ asset('images/produits/' ~ produit.image) }}"
                             alt="{{ produit.nom }}"
                             class="produit-image">
                    </td>
                    <td>{{ produit.nom }}</td>
                    <td>{{ produit.prix }} â‚¬</td>
                    <td>{{ produit.stock }}</td>
                    <td>
                        {% if max > 0 or min < 0 %}
                            <form method="post" action="{{ path('client_panier_ajouter') }}">
                                <input type="hidden" name="produit_id" value="{{ id }}">
                                <select name="quantite">
                                    {% for i in min..max %}
                                        <option value="{{ i }}" {% if i == 1 %}selected{% endif %}>
                                            {{ i > 0 ? '+' ~ i : (i < 0 ? i : '0') }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <button type="submit">Commander</button>
                            </form>
                        {% else %}
                            <span>Non disponible</span>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
